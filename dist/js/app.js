!function(){var t=[{name:"OMR Food Street",restaurantId:73176,lat:12.936892,lng:80.234603,imgSrc:"img/omr_food_street.jpg",imgAttribute:"Photo from omrfoodstreet.com",url:"http://www.omrfoodstreet.com/omr-food-street-blog/"},{name:"Dindigul Thalapakatti",restaurantId:65145,lat:12.925778,lng:80.230418,imgSrc:"img/dindigul_thalappakatti.jpg",imgAttribute:"Photo from tripadvisor.com",url:"http://www.thalappakatti.com"},{name:"Barbeque Nation",restaurantId:71405,lat:12.943841,lng:80.237892,imgSrc:"img/barbeque_nation.jpg",imgAttribute:"Photo from Zomato",url:"http://www.barbeque-nation.com"},{name:"Rasavid Multi Cuisine",restaurantId:66497,lat:12.915403,lng:80.229308,imgSrc:"img/rasavid.jpg",imgAttribute:"Photo from omrpedia.com",url:"http://rasavid.in"},{name:"Savoury Sea Shell",restaurantId:71554,lat:12.924776,lng:80.2305,imgSrc:"img/sea_shell.jpg",imgAttribute:"Photo from seashellchennai.com",url:"http://www.seashellchennai.com/"},{name:"Sigree Global Grill",restaurantId:68864,lat:12.930215,lng:80.231824,imgSrc:"img/sigree.jpg",imgAttribute:"Photo from thehindu.com",url:"http://www.seashellchennai.com"},{name:"Paradise Biriyani",restaurantId:73279,lat:12.972703,lng:80.249899,imgSrc:"img/paradise_biriyani.jpg",imgAttribute:"Photo from twitter.com",url:"http://www.zomato.com/chennai/paradise-perungudi"},{name:"FB Cake House",restaurantId:68854,lat:12.913762,lng:80.228814,imgSrc:"img/fb_cake_house.jpg",imgAttribute:"Photo from Zomato",url:"http://www.fbcakehouse.com"},{name:"Cream Stone",restaurantId:72584,lat:12.927413,lng:80.230861,imgSrc:"img/cream_stne.jpg",imgAttribute:"Photo from meethichhuri",url:"http://www.creamstoneconcepts.com"},{name:"Junior Kuppanna",restaurantId:71541,lat:12.969368,lng:80.248759,imgSrc:"img/junior_kuppanna.jpg",imgAttribute:"Photo from Zomato",url:"http://www.hoteljuniorkuppanna.com"},{name:"Domino's Pizza",restaurantId:71522,lat:12.957943,lng:80.243797,imgSrc:"img/dominos_pizza.jpg",imgAttribute:"Photo from Zomato",url:"http://www.dominos.co.in"},{name:"Hotel Saravana Bhavan",restaurantId:68885,lat:12.967413,lng:80.247971,imgSrc:"img/hotel_saravana_bhavan.jpg",imgAttribute:"Photo from Zomato",url:"http://www.saravanabhavan.com"}],e=function(t){this.name=t.name,this.resId=t.restaurantId,this.lat=t.lat,this.lng=t.lng,this.imgSrc=t.imgSrc,this.imgAttribute=t.imgAttribute,this.url=t.url},a=function(){var a=this;this.restaurantList=ko.observableArray([]),this.search=ko.observable(""),t.forEach(function(t){this.restaurantList.push(new e(t))},this),this.currentPlace=ko.observable(this.restaurantList()[0]),this.setPlace=function(t){a.currentPlace(t);var e=a.filteredItems().indexOf(t);a.updateContent(t),a.activateMarker(a.markers[e],a,a.infowindow)(),a.zomatoReviews(t.resId,t.name)},this.filteredItems=ko.computed(function(){var t=a.search().toLowerCase();return t?ko.utils.arrayFilter(a.restaurantList(),function(e){return-1!==e.name.toLowerCase().indexOf(t)}):a.restaurantList()}),this.map=new google.maps.Map(document.getElementById("map"),{center:{lat:12.944153,lng:80.23892},zoom:14}),this.markers=[],this.infowindow=new google.maps.InfoWindow({maxWidth:300}),this.renderMarkers(a.restaurantList()),this.filteredItems.subscribe(function(){a.renderMarkers(a.filteredItems())}),google.maps.event.addListener(a.map,"click",function(){a.deactivateAllMarkers(),a.infowindow.close()})};a.prototype.clearMarkers=function(){for(var t=0;t<this.markers.length;t++)this.markers[t].setMap(null);this.markers=[]},a.prototype.renderMarkers=function(t){this.clearMarkers();for(var e=this.infowindow,a=this,r=t,i=0,o=r.length;o>i;i++){var n={lat:r[i].lat,lng:r[i].lng},s=new google.maps.Marker({position:n,map:this.map,icon:"img/map-pin-default.png"});this.markers.push(s),this.markers[i].setMap(this.map),s.addListener("click",this.activateMarker(s,a,e,i))}},a.prototype.deactivateAllMarkers=function(){for(var t=this.markers,e=0;e<t.length;e++)t[e].setIcon("img/map-pin-default.png")},a.prototype.activateMarker=function(t,e,a,r){return function(){if(!isNaN(r)){var i=e.filteredItems()[r];e.updateContent(i)}a.close(),e.deactivateAllMarkers(),a.open(e.map,t),t.setIcon("img/map-pin-selected.png")}},a.prototype.updateContent=function(t){var e='<div class="info-content"><h4>'+t.name+'</h4><img height=300 width=300m alt="'+t.name+'" src="'+t.imgSrc+'"><em class="text-muted small">'+t.imgAttribute+'</em><br><a href = "'+t.url+'">Take me to their website</a></div>';this.infowindow.setContent(e)},a.prototype.zomatoReviews=function(t,e){var a=$("#review-header"),r=[],o=[],n=[],s=[];$("#review-area").hide(),a.show().removeClass("text-pink").addClass("text-muted text-center").text("Loading..."),$.ajax({type:"GET",dataType:"jsonp",cache:!0,url:"https://developers.zomato.com/api/v2.1/reviews?res_id="+t+"&apikey=1a70546f28c6740c7c48858d1f29b16a&count=5"}).done(function(t){for(i=0;i<t.reviewsShown;i++)r.push(t.userReviews[i].review.user.name),o.push(t.userReviews[i].review.rating),n.push(t.userReviews[i].review.reviewTimeFriendly),s.push(t.userReviews[i].review.reviewText);for(var a=$('<ul class="review-nav">'),l=0;l<t.reviewsShown;l++)a.append('<li class="zomato-div"><h5 class="text-pink">'+r[l]+'</h5><p class="small text-muted">Rating: '+o[l]+'</p><p class="small text-muted">Rated: '+n[l]+'</p><br><p class="small">'+s[l]+"</p><hr></li>");$("#review-area").html(a).show(),$("#review-header").removeClass("text-muted").addClass("text-pink").html('Recent reviews from &nbsp <a style="color:white" href="http://www.zomato.com">Zomato</a><br><h4>'+e+"</h4><hr>"),clearTimeout(m)});var m=setTimeout(function(){a.addClass("text-center").text("Unable to load Zomato reviews")},8e3)},ko.applyBindings(new a)}();