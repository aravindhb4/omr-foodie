function mapNotLoaded(){alert("Unable to load Google Maps. Please refresh the page")}function restaurantViewModel(){function e(){r=new google.maps.Map(document.getElementById("map"),{center:{lat:12.944153,lng:80.23892},zoom:13,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM,style:google.maps.ZoomControlStyle.small},streetViewControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM},mapTypeControl:!1,panControl:!1}),google.maps.event.addDomListener(window,"resize",function(){var e=r.getCenter();google.maps.event.trigger(r,"resize"),r.setCenter(e)}),t(i.restaurantList()),o=new google.maps.InfoWindow({maxWidth:300})}function t(e){$.each(e,function(e,t){var a=t.lat,n=t.lng,s=new google.maps.LatLng(a,n),m=t.name,l='<div class="info-content"><h3 class="text-pink">'+t.name+'</h3><img height=300 width=300 alt="'+t.name+'" src="'+t.imgSrc+'"><em class="text-muted small">'+t.imgAttribute+'</em><br><strong><a href = "'+t.url+'">Take me to their website</a></strong></div>',g=new google.maps.Marker({position:s,title:m,map:r,icon:"img/map-pin-default.png"});i.mapMarkers.push({marker:g,content:l}),google.maps.event.addListener(g,"click",function(){o.setContent(l),r.setZoom(14),r.setCenter(g.position),o.open(r,g),r.panBy(0,-150)})})}function a(e,t){var a,r,o,n;$.ajax({dataType:"jsonp",url:"https://developers.zomato.com/api/v2.1/reviews?res_id="+e+"&apikey=1a70546f28c6740c7c48858d1f29b16a&count=5",success:function(e){var s=e.reviewsShown;i.reviewList([]);for(var m=0;s>m;m++)a=e.userReviews[m].review.user.name,r=e.userReviews[m].review.rating,o=e.userReviews[m].review.reviewTimeFriendly,n=e.userReviews[m].review.reviewText,i.reviewList.push({reviewerName:a,restaurantRating:"Rating: "+r,reviewDate:o,reviewText:n});i.message("Recent reviews from Zomato"),i.restaurantName(t)},error:function(){i.message("Unable to load Zomato reviews. Please refresh the page")}})}var r,o,i=this;this.restaurantList=ko.observableArray([]),this.restaurantName=ko.observable(""),this.filteredList=ko.observableArray([]),this.mapMarkers=ko.observableArray([]),this.message=ko.observable("Please select a restaurant to view the recent reviews"),this.reviewList=ko.observableArray([]),this.currentLat=ko.observable(12.944153),this.currentLng=ko.observable(80.23892),restaurantData.forEach(function(e){this.restaurantList.push(new Place(e))},this),this.setPlace=function(e){var t=e.name,n=e.resId;for(var s in i.mapMarkers())t===i.mapMarkers()[s].marker.title&&(r.panTo(i.mapMarkers()[s].marker.position),r.setZoom(14),o.setContent(i.mapMarkers()[s].content),o.open(r,i.mapMarkers()[s].marker),r.panBy(0,-150));i.message("Loading Zomato Reviews..."),a(n,t)},this.search=ko.observable(""),this.filteredItems=ko.computed(function(){var e=i.search().toLowerCase();return e?ko.utils.arrayFilter(i.restaurantList(),function(t){return-1!==t.name.toLowerCase().indexOf(e)}):i.restaurantList()}),this.centerMap=function(){o.close();var e=r.getCenter(),t=new google.maps.LatLng(i.currentLat(),i.currentLng());t===e?alert("Map is already centered"):(r.panTo(t),r.setZoom(13))},e()}var restaurantData=[{name:"OMR Food Street",restaurantId:73176,lat:12.936892,lng:80.234603,imgSrc:"img/omr_food_street.jpg",imgAttribute:"Photo from omrfoodstreet.com",url:"http://www.omrfoodstreet.com/omr-food-street-blog"},{name:"Dindigul Thalapakatti",restaurantId:65145,lat:12.925778,lng:80.230418,imgSrc:"img/dindigul_thalappakatti.jpg",imgAttribute:"Photo from tripadvisor.com",url:"http://www.thalappakatti.com"},{name:"Barbeque Nation",restaurantId:71405,lat:12.943841,lng:80.237892,imgSrc:"img/barbeque_nation.jpg",imgAttribute:"Photo from Zomato",url:"http://www.barbeque-nation.com"},{name:"Rasavid Multi Cuisine",restaurantId:66497,lat:12.915403,lng:80.229308,imgSrc:"img/rasavid.jpg",imgAttribute:"Photo from omrpedia.com",url:"http://rasavid.in"},{name:"Savoury Sea Shell",restaurantId:71554,lat:12.924776,lng:80.2305,imgSrc:"img/sea_shell.jpg",imgAttribute:"Photo from seashellchennai.com",url:"http://www.seashellchennai.com/"},{name:"Sigree Global Grill",restaurantId:68864,lat:12.930215,lng:80.231824,imgSrc:"img/sigree.jpg",imgAttribute:"Photo from thehindu.com",url:"http://www.seashellchennai.com"},{name:"Paradise Biriyani",restaurantId:73279,lat:12.972703,lng:80.249899,imgSrc:"img/paradise_biriyani.jpg",imgAttribute:"Photo from twitter.com",url:"http://www.zomato.com/chennai/paradise-perungudi"},{name:"FB Cake House",restaurantId:68854,lat:12.913762,lng:80.228814,imgSrc:"img/fb_cake_house.jpg",imgAttribute:"Photo from Zomato",url:"http://www.fbcakehouse.com"},{name:"Cream Stone",restaurantId:72584,lat:12.927413,lng:80.230861,imgSrc:"img/cream_stone.jpg",imgAttribute:"Photo from meethichhuri",url:"http://www.creamstoneconcepts.com"},{name:"Junior Kuppanna",restaurantId:71541,lat:12.969368,lng:80.248759,imgSrc:"img/junior_kuppanna.jpg",imgAttribute:"Photo from Zomato",url:"http://www.hoteljuniorkuppanna.com"},{name:"Domino's Pizza",restaurantId:71522,lat:12.957943,lng:80.243797,imgSrc:"img/dominos_pizza.jpg",imgAttribute:"Photo from Zomato",url:"http://www.dominos.co.in"},{name:"Hotel Saravana Bhavan",restaurantId:68885,lat:12.967413,lng:80.247971,imgSrc:"img/hotel_saravana_bhavan.jpg",imgAttribute:"Photo from Zomato",url:"http://www.saravanabhavan.com"}],Place=function(e){this.name=e.name,this.resId=e.restaurantId,this.lat=e.lat,this.lng=e.lng,this.imgSrc=e.imgSrc,this.imgAttribute=e.imgAttribute,this.url=e.url};ko.applyBindings(new restaurantViewModel);