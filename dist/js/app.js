function mapNotLoaded(){alert("Unable to load Google Maps. Please refresh the page")}function restaurantViewModel(){function e(e){$.each(e,function(e,a){var s=a.lat,m=a.lng,l=new google.maps.LatLng(s,m),g=a.name;thisID=a.resId;var u='<div class="info-content"><h3 class="text-pink">'+a.name+'</h3><hr><img height=300 width=300 alt="'+a.name+'" src="'+a.imgSrc+'"><em class="text-muted small">'+a.imgAttribute+'</em><br><hr><strong><a href = "'+a.url+'">Take me to their website</a></strong></div>',p=new google.maps.Marker({position:l,title:g,id:thisID,map:o,animation:google.maps.Animation.DROP,icon:"img/map-pin-default.png"});n.mapMarkers.push({marker:p,content:u}),google.maps.event.addListener(p,"click",function(){t(p.id,p.title),r(),i.setContent(u),o.setZoom(14),o.setCenter(p.position),i.open(o,p),o.panBy(0,-150),p.setIcon("img/map-pin-selected.png"),p.setAnimation(google.maps.Animation.BOUNCE)})})}function t(e,t){var a,r,o,i;n.message("Loading Zomato Reviews..."),$.ajax({dataType:"jsonp",url:"https://developers.zomato.com/api/v2.1/reviews?res_id="+e+"&apikey=1a70546f28c6740c7c48858d1f29b16a&count=5",success:function(e){var s=e.reviewsShown;n.reviewList([]);for(var m=0;s>m;m++)a=e.userReviews[m].review.user.name,r=e.userReviews[m].review.rating,o=e.userReviews[m].review.reviewTimeFriendly,i=e.userReviews[m].review.reviewText,n.reviewList.push({reviewerName:a,restaurantRating:"Rating: "+r,reviewDate:o,reviewText:i});n.message("Last 5 reviews from Zomato"),n.restaurantName(t)},error:function(){n.message("Unable to load Zomato reviews. Please refresh the page")}})}function a(){$.each(n.mapMarkers(),function(e,t){t.marker.setMap(null)}),n.mapMarkers([])}function r(){$.each(n.mapMarkers(),function(e,t){t.marker.setIcon("img/map-pin-default.png"),t.marker.setAnimation(null)})}var o,i,n=this;this.restaurantList=ko.observableArray([]),this.restaurantName=ko.observable(""),this.mapMarkers=ko.observableArray([]),this.message=ko.observable("Please select a restaurant to view recent reviews from Zomato"),this.reviewList=ko.observableArray([]),this.currentLat=ko.observable(12.944153),this.currentLng=ko.observable(80.23892),restaurantData.forEach(function(e){this.restaurantList.push(new Place(e))},this),this.search=ko.observable(""),this.filteredItems=ko.computed(function(){var e=n.search().toLowerCase();return e?ko.utils.arrayFilter(n.restaurantList(),function(t){return-1!==t.name.toLowerCase().indexOf(e)}):n.restaurantList()}),this.filteredItems.subscribe(function(){n.filteredItems().length<1?(n.message("Sorry, no macthing results are found!"),n.reviewList([]),n.restaurantName("")):(n.reviewList([]),n.restaurantName(""),n.message("Please select a restaurant to view recent reviews from Zomato")),a(),e(n.filteredItems())}),this.setPlace=function(e){var a=e.name,r=e.resId;for(var s in n.mapMarkers())a===n.mapMarkers()[s].marker.title?(o.panTo(n.mapMarkers()[s].marker.position),o.setZoom(14),n.mapMarkers()[s].marker.setIcon("img/map-pin-selected.png"),i.setContent(n.mapMarkers()[s].content),i.open(o,n.mapMarkers()[s].marker),n.mapMarkers()[s].marker.setAnimation(google.maps.Animation.BOUNCE),o.panBy(0,-150)):(n.mapMarkers()[s].marker.setIcon("img/map-pin-default.png"),n.mapMarkers()[s].marker.setAnimation(null));t(r,a)},this.mapInitialize=function(){o=new google.maps.Map(document.getElementById("map"),{center:{lat:12.944153,lng:80.23892},zoom:13,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM,style:google.maps.ZoomControlStyle.small},streetViewControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM},mapTypeControl:!1,panControl:!1}),google.maps.event.addDomListener(window,"resize",function(){var e=o.getCenter();google.maps.event.trigger(o,"resize"),o.setCenter(e)}),e(n.restaurantList()),i=new google.maps.InfoWindow({maxWidth:300}),google.maps.event.addListener(o,"click",function(){r(),i.close(),n.reviewList([]),n.restaurantName(""),n.message("Please select a restaurant to view recent reviews from Zomato")})},this.centerMap=function(){r(),i.close();var e=o.getCenter(),t=new google.maps.LatLng(n.currentLat(),n.currentLng());t===e?alert("Map is already centered."):(o.panTo(t),o.setZoom(13))}}var restaurantData=[{name:"OMR Food Street",restaurantId:73176,lat:12.936892,lng:80.234603,imgSrc:"img/omr_food_street.jpg",imgAttribute:"Photo from omrfoodstreet.com",url:"http://www.omrfoodstreet.com/omr-food-street-blog"},{name:"Dindigul Thalapakatti",restaurantId:65145,lat:12.925778,lng:80.230418,imgSrc:"img/dindigul_thalappakatti.jpg",imgAttribute:"Photo from tripadvisor.com",url:"http://www.thalappakatti.com"},{name:"Barbeque Nation",restaurantId:71405,lat:12.943841,lng:80.237892,imgSrc:"img/barbeque_nation.jpg",imgAttribute:"Photo from Zomato",url:"http://www.barbeque-nation.com"},{name:"Rasavid Multi Cuisine",restaurantId:66497,lat:12.915403,lng:80.229308,imgSrc:"img/rasavid.jpg",imgAttribute:"Photo from omrpedia.com",url:"http://rasavid.in"},{name:"Savoury Sea Shell",restaurantId:71554,lat:12.924776,lng:80.2305,imgSrc:"img/sea_shell.jpg",imgAttribute:"Photo from seashellchennai.com",url:"http://www.seashellchennai.com/"},{name:"Sigree Global Grill",restaurantId:68864,lat:12.930215,lng:80.231824,imgSrc:"img/sigree.jpg",imgAttribute:"Photo from thehindu.com",url:"http://www.seashellchennai.com"},{name:"Paradise Biriyani",restaurantId:73279,lat:12.972703,lng:80.249899,imgSrc:"img/paradise_biriyani.jpg",imgAttribute:"Photo from twitter.com",url:"http://www.zomato.com/chennai/paradise-perungudi"},{name:"FB Cake House",restaurantId:68854,lat:12.913762,lng:80.228814,imgSrc:"img/fb_cake_house.jpg",imgAttribute:"Photo from Zomato",url:"http://www.fbcakehouse.com"},{name:"Cream Stone",restaurantId:72584,lat:12.927413,lng:80.230861,imgSrc:"img/cream_stone.jpg",imgAttribute:"Photo from meethichhuri",url:"http://www.creamstoneconcepts.com"},{name:"Junior Kuppanna",restaurantId:71541,lat:12.969368,lng:80.248759,imgSrc:"img/junior_kuppanna.jpg",imgAttribute:"Photo from Zomato",url:"http://www.hoteljuniorkuppanna.com"},{name:"Domino's Pizza",restaurantId:71522,lat:12.957943,lng:80.243797,imgSrc:"img/dominos_pizza.jpg",imgAttribute:"Photo from Zomato",url:"http://www.dominos.co.in"},{name:"Hotel Saravana Bhavan",restaurantId:68885,lat:12.967413,lng:80.247971,imgSrc:"img/hotel_saravana_bhavan.jpg",imgAttribute:"Photo from Zomato",url:"http://www.saravanabhavan.com"}],Place=function(e){this.name=e.name,this.resId=e.restaurantId,this.lat=e.lat,this.lng=e.lng,this.imgSrc=e.imgSrc,this.imgAttribute=e.imgAttribute,this.url=e.url},vm=new restaurantViewModel;ko.applyBindings(vm);