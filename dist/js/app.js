function mapNotLoaded(){alert("Unable to load Google Maps. Please refresh the page")}function restaurantViewModel(){function e(){i=new google.maps.Map(document.getElementById("map"),{center:{lat:12.944153,lng:80.23892},zoom:13,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM,style:google.maps.ZoomControlStyle.small},streetViewControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM},mapTypeControl:!1,panControl:!1}),google.maps.event.addDomListener(window,"resize",function(){var e=i.getCenter();google.maps.event.trigger(i,"resize"),i.setCenter(e)}),t(s.restaurantList()),n=new google.maps.InfoWindow({maxWidth:300}),google.maps.event.addListener(i,"click",function(){o(),n.close(),s.reviewList([]),s.restaurantName(""),s.message("Please select a restaurant to view recent reviews from Zomato")})}function t(e){$.each(e,function(e,t){var r=t.lat,m=t.lng,l=new google.maps.LatLng(r,m),g=t.name;thisID=t.resId;var u='<div class="info-content"><h3 class="text-pink">'+t.name+'</h3><hr><img height=300 width=300 alt="'+t.name+'" src="'+t.imgSrc+'"><em class="text-muted small">'+t.imgAttribute+'</em><br><hr><strong><a href = "'+t.url+'">Take me to their website</a></strong></div>',p=new google.maps.Marker({position:l,title:g,id:thisID,map:i,animation:google.maps.Animation.DROP,icon:"img/map-pin-default.png"});s.mapMarkers.push({marker:p,content:u}),google.maps.event.addListener(p,"click",function(){a(p.id,p.title),o(),n.setContent(u),i.setZoom(14),i.setCenter(p.position),n.open(i,p),i.panBy(0,-150),p.setIcon("img/map-pin-selected.png"),p.setAnimation(google.maps.Animation.BOUNCE)})})}function a(e,t){var a,r,o,i;s.message("Loading Zomato Reviews..."),$.ajax({dataType:"jsonp",url:"https://developers.zomato.com/api/v2.1/reviews?res_id="+e+"&apikey=1a70546f28c6740c7c48858d1f29b16a&count=5",success:function(e){var n=e.reviewsShown;s.reviewList([]);for(var m=0;n>m;m++)a=e.userReviews[m].review.user.name,r=e.userReviews[m].review.rating,o=e.userReviews[m].review.reviewTimeFriendly,i=e.userReviews[m].review.reviewText,s.reviewList.push({reviewerName:a,restaurantRating:"Rating: "+r,reviewDate:o,reviewText:i});s.message("Last 5 reviews from Zomato"),s.restaurantName(t)},error:function(){s.message("Unable to load Zomato reviews. Please refresh the page")}})}function r(){$.each(s.mapMarkers(),function(e,t){t.marker.setMap(null)}),s.mapMarkers([])}function o(){$.each(s.mapMarkers(),function(e,t){t.marker.setIcon("img/map-pin-default.png"),t.marker.setAnimation(null)})}var i,n,s=this;this.restaurantList=ko.observableArray([]),this.restaurantName=ko.observable(""),this.mapMarkers=ko.observableArray([]),this.message=ko.observable("Please select a restaurant to view recent reviews from Zomato"),this.reviewList=ko.observableArray([]),this.currentLat=ko.observable(12.944153),this.currentLng=ko.observable(80.23892),restaurantData.forEach(function(e){this.restaurantList.push(new Place(e))},this),this.search=ko.observable(""),this.filteredItems=ko.computed(function(){var e=s.search().toLowerCase();return e?ko.utils.arrayFilter(s.restaurantList(),function(t){return-1!==t.name.toLowerCase().indexOf(e)}):s.restaurantList()}),this.filteredItems.subscribe(function(){s.filteredItems().length<1?(s.message("Sorry, no macthing results are found!"),s.reviewList([]),s.restaurantName("")):(s.reviewList([]),s.restaurantName(""),s.message("Please select a restaurant to view recent reviews from Zomato")),r(),t(s.filteredItems())}),this.setPlace=function(e){var t=e.name,r=e.resId;for(var o in s.mapMarkers())t===s.mapMarkers()[o].marker.title?(i.panTo(s.mapMarkers()[o].marker.position),i.setZoom(14),s.mapMarkers()[o].marker.setIcon("img/map-pin-selected.png"),n.setContent(s.mapMarkers()[o].content),n.open(i,s.mapMarkers()[o].marker),s.mapMarkers()[o].marker.setAnimation(google.maps.Animation.BOUNCE),i.panBy(0,-150)):(s.mapMarkers()[o].marker.setIcon("img/map-pin-default.png"),s.mapMarkers()[o].marker.setAnimation(null));a(r,t)},this.centerMap=function(){o(),n.close();var e=i.getCenter(),t=new google.maps.LatLng(s.currentLat(),s.currentLng());t===e?alert("Map is already centered."):(i.panTo(t),i.setZoom(13))},e()}var restaurantData=[{name:"OMR Food Street",restaurantId:73176,lat:12.936892,lng:80.234603,imgSrc:"img/omr_food_street.jpg",imgAttribute:"Photo from omrfoodstreet.com",url:"http://www.omrfoodstreet.com/omr-food-street-blog"},{name:"Dindigul Thalapakatti",restaurantId:65145,lat:12.925778,lng:80.230418,imgSrc:"img/dindigul_thalappakatti.jpg",imgAttribute:"Photo from tripadvisor.com",url:"http://www.thalappakatti.com"},{name:"Barbeque Nation",restaurantId:71405,lat:12.943841,lng:80.237892,imgSrc:"img/barbeque_nation.jpg",imgAttribute:"Photo from Zomato",url:"http://www.barbeque-nation.com"},{name:"Rasavid Multi Cuisine",restaurantId:66497,lat:12.915403,lng:80.229308,imgSrc:"img/rasavid.jpg",imgAttribute:"Photo from omrpedia.com",url:"http://rasavid.in"},{name:"Savoury Sea Shell",restaurantId:71554,lat:12.924776,lng:80.2305,imgSrc:"img/sea_shell.jpg",imgAttribute:"Photo from seashellchennai.com",url:"http://www.seashellchennai.com/"},{name:"Sigree Global Grill",restaurantId:68864,lat:12.930215,lng:80.231824,imgSrc:"img/sigree.jpg",imgAttribute:"Photo from thehindu.com",url:"http://www.seashellchennai.com"},{name:"Paradise Biriyani",restaurantId:73279,lat:12.972703,lng:80.249899,imgSrc:"img/paradise_biriyani.jpg",imgAttribute:"Photo from twitter.com",url:"http://www.zomato.com/chennai/paradise-perungudi"},{name:"FB Cake House",restaurantId:68854,lat:12.913762,lng:80.228814,imgSrc:"img/fb_cake_house.jpg",imgAttribute:"Photo from Zomato",url:"http://www.fbcakehouse.com"},{name:"Cream Stone",restaurantId:72584,lat:12.927413,lng:80.230861,imgSrc:"img/cream_stone.jpg",imgAttribute:"Photo from meethichhuri",url:"http://www.creamstoneconcepts.com"},{name:"Junior Kuppanna",restaurantId:71541,lat:12.969368,lng:80.248759,imgSrc:"img/junior_kuppanna.jpg",imgAttribute:"Photo from Zomato",url:"http://www.hoteljuniorkuppanna.com"},{name:"Domino's Pizza",restaurantId:71522,lat:12.957943,lng:80.243797,imgSrc:"img/dominos_pizza.jpg",imgAttribute:"Photo from Zomato",url:"http://www.dominos.co.in"},{name:"Hotel Saravana Bhavan",restaurantId:68885,lat:12.967413,lng:80.247971,imgSrc:"img/hotel_saravana_bhavan.jpg",imgAttribute:"Photo from Zomato",url:"http://www.saravanabhavan.com"}],Place=function(e){this.name=e.name,this.resId=e.restaurantId,this.lat=e.lat,this.lng=e.lng,this.imgSrc=e.imgSrc,this.imgAttribute=e.imgAttribute,this.url=e.url};ko.applyBindings(new restaurantViewModel);